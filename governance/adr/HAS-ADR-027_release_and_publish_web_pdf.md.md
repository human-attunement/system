# ADR-027 Web（HonKit）および PDF を含めた Publish 方針の決定

## Status
Accepted

## Context
HASではこれまで、文書の生成・公開について明確な分離と固定された運用方針が存在していなかった。

特に以下の点が曖昧だった。

- Webサイト（HonKit）と PDF の役割の違い
- どのタイミングで何を生成・公開するのか
- Git tag / Release / gh-pages との関係
- 人手による運用判断が介在する余地

加えて、PDF生成（Quarto）を正式に導入したことで、
Web と PDF を **同一の「公開物」ではなく、異なる性質を持つ成果物**として整理する必要が生じた。

HASの原則である
- 人の判断負荷を増やさない
- 後から読み返して迷わない
- 忘却を前提とした運用

を満たすため、Publish 方針を明示的に決定する必要があった。

## Problem
Webサイト（HonKit）と PDF を含めた公開物について、

- 何を「最新」とみなすのか
- 何を「固定された成果物」として残すのか
- Git tag / Release とどのように対応づけるのか
- 手動判断を最小化した運用をどう実現するか

を、一貫した形で決める必要がある。

## Forces
- 手動での運用判断は確実に破綻する
- 正確性よりも「思い出せる」「追跡できる」ことが重要
- パッチレベルの変更では ADR を書かないケースが多い
- Web と PDF を同一視すると、役割が曖昧になる
- Git tag は既に「意味のある区切り」として機能している

## Decision
以下の Publish 方針を採用する。

### 1. 公開物の役割分離

- **Webサイト（HonKit）**
  - 常に「最新状態」を表示する
  - 過去バージョンは保持しない
  - 表示内容は、タグ後に生成された最新の成果物

- **PDF**
  - 静的な成果物として扱う
  - 以下の2系統を持つ
    - `has-manual-recent.pdf`：常に最新（上書き）
    - `has-manual-vX.Y.Z.pdf`：Git tag に対応した固定版

### 2. 生成・公開のタイミング

- **Git tag が打たれた後**にのみ、公開物を生成・公開する
- タグ以前の状態は「作業中」とみなし、公開対象にしない

### 3. Git / Pages との対応

- Git tag：意味のある区切り（真実の基点）
- gh-pages：
  - Web（HonKit）：ルートに配置
  - PDF：`pdf/` 配下に配置
- GitHub Release：
  - 任意
  - 作成する場合は、タグ後・PDF生成後に行う
  - リリースノートは自動生成を基本とする

### 4. 運用の自動化

- PDF生成・公開はスクリプト経由で行う
- 人が「何を出すか」を判断しない
- 人は「タグを打つ」だけに責務を限定する

## Rationale
- Web と PDF の役割を分離することで、誤解と過剰管理を防げる
- Git tag を中心に据えることで、履歴の一貫性が保たれる
- `recent` と `versioned` を分けることで、
  - 常に参照できる最新
  - 後から確実に指し示せる固定版
  の両立が可能になる
- 自動化を前提にすることで、運用が継続可能になる

## Pros & Cons
- \+ 公開物の意味と役割が明確になる
- \+ 人の判断・記憶・注意力に依存しない
- \+ Web / PDF / Release の混線を防げる
- − 公開手順が一見増えたように見える
- − Web に過去バージョンを残さない設計になる

## Note
この方針は「完璧な履歴管理」ではなく、
**未来の自分が迷わないこと**を優先している。

正確性よりも、追跡可能性と作業負荷の低さを重視する。

## Alternatives Considered
- Web と PDF を同一の成果物として扱う
  - 不採用理由：役割が曖昧になり、更新判断が破綻する
- 毎リリースで手動のリリースノートを書く
  - 不採用理由：継続不能
- ADR とリリースを完全に1対1対応させる
  - 不採用理由：パッチレベル変更を扱えない

## Consequences
- Publish は「タグ後の作業」として固定される
- PDF は参照・共有・保存の基点として安定する
- Web は「今のHAS」を示す入口として機能する
- 将来の自分は、この決定を疑わずに済む

## Version
Decision: 1.0  
Code: v2.4.3

## Date
2025-12-27
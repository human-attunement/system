# ADR-0XX: Versioning and Release Process Governance

## Status
Accepted

## Context
HASドキュメント群の運用において、以下の問題が顕在化した。

- バージョン番号がAIにより任意に付与され、採番ルールが不明確だった
- GitリポジトリをAIが直接参照できないため、Document Control（Version / Date / Status など）の記述が表記ゆれ・更新漏れを起こしやすい
- Kernel・Manifesto・Principlesなど、相互参照される文書が増えるにつれ、前提の整合性が崩れたときの回復コストが上がっている
- 世話人が単独である現状において、厳密なリリース管理を導入すると運用負荷が過剰になる一方、無秩序な運用は将来の自分の混乱を確実に招く

このため「最小の儀式」と「自動注入」によって、区切りの確定点を保ちつつ、運用コストを抑える設計が必要になった。

## Problem
開発・更新が継続するドキュメント群に対して、次の問いに答える必要がある。

1. 公式なバージョン番号は何に基づいて決まるべきか（人間の恣意か、Gitの事実か）
2. リリースの「区切り」を、最低コストで再現可能な確定点として残すにはどうするか
3. Document Control を文書に含める場合、運用コストに見合う最小構成は何か
4. ブランチ運用を前提にした場合でも、バージョンとリリースの意味が破綻しない手順は何か

## Forces
- **低コスト運用の要求:** 世話人が単独で、手動メタデータ管理は持続しない
- **整合性の要求:** Kernelを中心に文書が相互参照するため、確定点が曖昧だと混乱が増幅する
- **AI協働の制約:** AIはGitを直接見られず、手動での調整は人的負荷が高い
- **儀式の過剰化リスク:** 厳密すぎるプロセスは続かない（続かないものは存在しない）
- **タグの信頼性:** タグの移動・改変は信頼を損なうため、共有後は不変である必要がある

## Decision
以下を採用する。

1. **正式バージョンはリポジトリのGitタグを正とする**
   - 形式は `vX.Y.ZZ`（注釈付きタグ）
   - 文書個別の「v3」等の内部番号は正式採用しない（必要なら内部呼称としてのみ扱う）

2. **リリースは main ブランチの確定状態に対してのみ実施する**
   - 変更はブランチで行い、main にマージした後にリリース儀式を実施する
   - ブランチ上でタグを切らない（意味が破綻するため）

3. **Document Control は最小構成とし、Git情報から自動注入する**
   - Document Control は人間が編集しない
   - 注入対象は「Git由来の事実」に限定する（判断を含めない）
     - Repo Version（`git describe --tags --always`）
     - Last Modified（ファイルの最終更新日）
     - Commit（ファイル最終更新コミット）
     - Author（最終更新者）

4. **ミニマム儀式として release commit を導入する**
   - リリース時に自動注入を走らせ、必要なら `chore(release): vX.Y.ZZ` のコミットを作成し、そのコミットにタグを付与する
   - これをスクリプトで定型化する（`release.sh`）

5. **タグ忘れ等の人為ミスは「回復可能性」を設計に含める**
   - 過去の正しいコミットに後付けでタグを付与する手順（`tag_at.sh`）を用意する
   - push後のタグ移動は原則行わない（必要なら新タグで訂正する）

## Scope

本ADRで定義する **バージョン管理および Document Control 自動注入の対象**は、
以下のディレクトリ配下に存在するすべての文書とする。

core/**
docs/**
governance/**

### 対象範囲の内訳

- **core/**
  - Kernel
  - Constitution
  - 禁忌・前提条件など、HASの不可侵な中核定義

- **docs/**
  - Manifesto
  - Concept
  - Principles
  - Architecture Map / System Map
  - Glossary
  - FAQ

- **governance/**
  - バージョニング規則
  - リリースプロセス
  - 運用・管理に関するルール文書

これらはすべて、HASにおける
**「現在の正（official state）」を規定・参照する文書**であるため、
Gitタグを基準とした確定点と Document Control を持つ。

---

### 対象外

以下は本ADRの対象外とする。

- ADR（Architecture Decision Records）
- Resources（参考資料・外部リンク集）
- 上記以外の補助的・一時的・草稿ファイル

---

### 判断理由

- ディレクトリ単位で対象を定義することで、
  - 選別ロジックを不要にする
  - スクリプト運用を単純化する
  - 人為的な判断ミスを排除する
- core / docs / governance は、
  **読者・実践者が前提として信頼する層**であり、
  状態の確定点が曖昧であってはならない
- ADRは「決定の履歴」であり、
  現行ルールや正の定義ではないため対象外とする

---

## Rationale
- **Gitを唯一の正にする**ことで、AIと人間の共同編集でも「確定点」がブレない
- Document Control を「事実」だけに限定することで、更新漏れや恣意的判断を排除できる
- 世話人単独の現状では、フルのリリース管理は過剰。最小儀式（区切りの固定）に目的を絞ることで持続可能になる
- mainに限定することで「公式状態」が定義され、将来の参加者が増えても説明が破綻しない
- ミスを前提に回復手順を用意することで、運用が心理的に重くならず、継続できる

## Pros & Cons
+ 公式バージョンと文書状態の参照点が明確になる（タグ＝確定点）
+ AIが勝手に付番する混乱を防げる（Gitタグが正）
+ Document Control の更新コストがほぼゼロになる（自動注入）
+ ミス（タグ忘れ等）への回復手順が明示され、運用の心理負荷が下がる
+ main基準の運用により、ブランチ作業を自由にできる

− リリース時に「儀式」を行う必要がある（ただし最小限）
− タグ運用を忘れると区切りが曖昧になる（ただし後付けで回復可能）
− 文書単体の内部バージョン表記がなくなるため、個別文書の変更履歴はGitに委ねられる

## Note
- Kernel等のファイル名に `v2.0` のような内部番号を含めると、正式SemVerと混線しやすい。可能ならファイル名からバージョン表記を除去し、タグとDocument Controlに一元化する。
- Document Control を付ける対象は「判断に使う文書」に限定する（例：Manifesto / Kernel / Principles / Governance）。FAQやGlossaryなど説明文書は省略可能。
- タグは注釈付き（annotated）を推奨する。共有後のタグ移動は禁止（信頼性のため）。

## Alternatives Considered
1. **文書ごとに手動でVersion/Dateを管理する**
   - 不採用：更新漏れ・表記ゆれ・AI介在で破綻する。運用コストが高すぎる。

2. **pre-commit/CIで常時Document Control更新を強制する**
   - 不採用（現時点）：単独世話人・ミニマム運用に対して過剰。将来、参加者が増えた段階で再検討。

3. **ブランチでもタグを切る運用**
   - 不採用：公式状態が曖昧になり、マージ後にタグの意味が崩れる。

4. **タグを付けず、コミットSHAのみで参照する**
   - 不採用：人間が読み取りにくく、区切りの認知が困難。タグの役割（意味のラベル付け）を失う。

## Consequences
- 公式な区切りは `vX.Y.ZZ` タグによってのみ表現される
- リリース時には `release.sh` 実行が標準動作となる
- 文書のメタ情報は手動編集されず、Git事実から自動生成される
- 今後、参加者が増えたり運用が複雑化した場合は、pre-commit/CI強制の導入を検討する余地が残る

---

## Version
Decision: 1.0.0  
Code: N/A

## Date
2025-12-17